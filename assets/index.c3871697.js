var e,t,i,o,n,s,r=Object.defineProperty,a=Object.defineProperties,c=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,u=(e,t,i)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,p=(e,t)=>{for(var i in t||(t={}))d.call(t,i)&&u(e,i,t[i]);if(l)for(var i of l(t))h.call(t,i)&&u(e,i,t[i]);return e},f=(e,t)=>a(e,c(t)),m=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},y=(e,t,i)=>(m(e,t,"read from private field"),i?i.call(e):t.get(e)),b=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},g=(e,t,i,o)=>(m(e,t,"write to private field"),o?o.call(e,i):t.set(e,i),i);import{f as x,s as v,l as P,c as R,p as k,a as w,r as E,R as B,b as N}from"./vendor.a311bb36.js";function O(e){const{kingPositions:t,board:i,notKingPiece:o}=e,[n,s]=t;if(n.x!==s.x)return!1;{const e=n.x,t=i.pieces.filter((t=>t.position.x===e)).filter((e=>e.position.y>Math.min(n.y,s.y)&&e.position.y<Math.max(n.y,s.y)));if(t.length>=2)return!1;if(0===t.length)return!0;const r=t[0];return!(!o||r!==(null==o?void 0:o.piece)||o.nextPosition.x===e)}}function j(e,t,o){const n=o.value;o.value=function(...e){let t=n.apply(this,[...e]);return t=t.filter((e=>A.load(e).valid())).map((e=>e instanceof A?e.dump():e)),t.filter((e=>{const[t,o]=this.board.pieces.filter((e=>e.type===i.King));return!t||!o||!O({kingPositions:[t.position,o.position],board:this.board,notKingPiece:{piece:this,nextPosition:e}})}))}}(o=i||(i={})).King="King",o.Advisor="Advisor",o.Bishop="Bishop",o.Knight="Knight",o.Rook="Rook",o.Cannon="Cannon",o.Pawn="Pawn",(s=n||(n={})).Red="Red",s.Black="Black";class C{constructor(){this.minX=1,this.maxX=9,this.minY=1,this.maxY=10}}class A extends C{constructor(e){super(),this.x=e.x,this.y=e.y}static load(e){return new A(e)}clone(){return new A(this.dump())}equal(e){return this.x===e.x&&this.y===e.y}valid(){const e=this.x>=this.minX&&this.x<=this.maxX,t=this.y>=this.minY&&this.y<=this.maxY;return e&&t}top(e=1){return this.y=this.y-e,this}right(e=1){return this.x=this.x+e,this}bottom(e=1){return this.top(-e),this}left(e=1){return this.right(-e),this}dump(){return{x:this.x,y:this.y}}}class K extends C{constructor(e){super(),this.board=e.board,this.type=e.type,this.side=e.side,this.initPosition=e.initPosition,this.position=e.initPosition}at(e){return this.position.x===e.x&&this.position.y===e.y}nextPositionsContain(e){return this.getNextPositions().some((t=>{return o=e,(i=t).x===o.x&&i.y===o.y;var i,o}))}getFENChar(){const e=this.type.charAt(0);return this.side===n.Red?e:e.toLowerCase()}dump(){return{type:this.type,side:this.side,position:this.position}}}K.Type=i,K.Side=n;class S extends K{constructor(e){super(f(p({},e),{type:i.Pawn}))}static createRed(e){return new S(f(p({},e),{side:n.Red}))}static createBlack(e){return new S(f(p({},e),{side:n.Black}))}getName(){return this.side===n.Red?"兵":"卒"}getNextPositions(){const e=A.load(this.position);return this.side===n.Black?e.y<=5?[e.clone().bottom()]:[e.clone().bottom(),e.clone().right(),e.clone().left()]:e.y>=6?[e.clone().top()]:[e.clone().top(),e.clone().right(),e.clone().left()]}}!function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);s>3&&r&&Object.defineProperty(t,i,r)}([j],S.prototype,"getNextPositions",null);class I extends K{constructor(e){super(f(p({},e),{type:i.Cannon}))}static createRed(e){return new I(f(p({},e),{side:n.Red}))}static createBlack(e){return new I(f(p({},e),{side:n.Black}))}getName(){return this.side===n.Red?"炮":"砲"}getNextPositions(){const e=[],t=A.load(this.position),i=[0,0,0,0],o=(e=1)=>[t.clone().top(e),t.clone().right(e),t.clone().bottom(e),t.clone().left(e)];let n=1;for(;;){const t=o(n);if(!t.find((e=>e.valid())))break;t.forEach(((t,o)=>{if(!t.valid())return;const n=this.board.findPiece(t);n||0!==i[o]||e.push(t),n&&(1===i[o]&&n.side!==this.side&&e.push(t),i[o]+=1)})),n+=1}return e}}!function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);s>3&&r&&Object.defineProperty(t,i,r)}([j],I.prototype,"getNextPositions",null);class M extends K{constructor(e){super(f(p({},e),{type:i.Rook}))}static createRed(e){return new M(f(p({},e),{side:n.Red}))}static createBlack(e){return new M(f(p({},e),{side:n.Black}))}getName(){return this.side===n.Red?"俥":"車"}getNextPositions(){const e=[],t=A.load(this.position),i=[0,0,0,0],o=(e=1)=>[t.clone().top(e),t.clone().right(e),t.clone().bottom(e),t.clone().left(e)];let n=1;for(;;){const t=o(n);if(!t.find((e=>e.valid())))break;t.forEach(((t,o)=>{if(!t.valid())return;const n=this.board.findPiece(t);n||0!==i[o]||e.push(t),n&&(0===i[o]&&n.side!==this.side&&e.push(t),i[o]+=1)})),n+=1}return e}}!function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);s>3&&r&&Object.defineProperty(t,i,r)}([j],M.prototype,"getNextPositions",null);class $ extends K{constructor(e){super(f(p({},e),{type:i.Knight}))}static createRed(e){return new $(f(p({},e),{side:n.Red}))}static createBlack(e){return new $(f(p({},e),{side:n.Black}))}getName(){return this.side===n.Red?"傌":"馬"}getNextPositions(){const e=[],t=A.load(this.position),i={top:t.clone().top(),right:t.clone().right(),bottom:t.clone().bottom(),left:t.clone().left()},o={top:[t.clone().top(2).left(),t.clone().top(2).right()],right:[t.clone().right(2).top(),t.clone().right(2).bottom()],bottom:[t.clone().bottom(2).left(),t.clone().bottom(2).right()],left:[t.clone().left(2).top(),t.clone().left(2).bottom()]};return Object.keys(i).forEach((t=>{this.board.findPiece(i[t])||o[t].forEach((t=>{const i=this.board.findPiece(t);i||e.push(t),i&&i.side!==this.side&&e.push(t)}))})),e}getFENChar(){const e=this.type.charAt(1);return this.side===n.Red?e:e.toLowerCase()}}!function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);s>3&&r&&Object.defineProperty(t,i,r)}([j],$.prototype,"getNextPositions",null);class X extends K{constructor(e){super(f(p({},e),{type:i.Bishop}))}static createRed(e){return new X(f(p({},e),{side:n.Red}))}static createBlack(e){return new X(f(p({},e),{side:n.Black}))}getName(){return this.side===n.Red?"相":"象"}getNextPositions(){const e=[],t=A.load(this.position),i={topLeft:t.clone().top().left(),topRight:t.clone().top().right(),bottomLeft:t.clone().bottom().left(),bottomRight:t.clone().bottom().right()},o={topLeft:t.clone().top(2).left(2),topRight:t.clone().top(2).right(2),bottomLeft:t.clone().bottom(2).left(2),bottomRight:t.clone().bottom(2).right(2)};return Object.keys(i).forEach((t=>{if(!this.board.findPiece(i[t])){const i=o[t],n=this.board.findPiece(i);n||e.push(i),n&&n.side!==this.side&&e.push(i)}})),e.filter((e=>this.side===n.Red?e.y>=6:e.y<=5))}}!function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);s>3&&r&&Object.defineProperty(t,i,r)}([j],X.prototype,"getNextPositions",null);class D extends K{constructor(e){super(f(p({},e),{type:i.Advisor}))}static createRed(e){return new D(f(p({},e),{side:n.Red}))}static createBlack(e){return new D(f(p({},e),{side:n.Black}))}getName(){return this.side===n.Red?"仕":"士"}getNextPositions(){const e=[],t=A.load(this.position);return[t.clone().top().left(),t.clone().top().right(),t.clone().bottom().left(),t.clone().bottom().right()].forEach((t=>{const i=this.board.findPiece(t);i||e.push(t),i&&i.side!==this.side&&e.push(t)})),e.filter((e=>e.x>=4&&e.x<=6&&(this.side===n.Red?e.y>=8&&e.y<=10:e.y>=1&&e.y<=3)))}getFENChar(){const e=this.type.charAt(0);return this.side===n.Red?e:e.toLowerCase()}}!function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);s>3&&r&&Object.defineProperty(t,i,r)}([j],D.prototype,"getNextPositions",null);class L extends K{constructor(e){super(f(p({},e),{type:i.King}))}static createRed(e){return new L(f(p({},e),{side:n.Red}))}static createBlack(e){return new L(f(p({},e),{side:n.Black}))}getName(){return this.side===n.Red?"帥":"將"}getNextPositions(){let e=[];const t=A.load(this.position);[t.clone().top(),t.clone().right(),t.clone().bottom(),t.clone().left()].forEach((t=>{const i=this.board.findPiece(t);i||e.push(t),i&&i.side!==this.side&&e.push(t)})),e=e.filter((e=>e.x>=4&&e.x<=6&&(this.side===n.Red?e.y>=8&&e.y<=10:e.y>=1&&e.y<=3)));const o=this.board.pieces.find((e=>e.type===i.King&&e.side!==this.side));return e.filter((e=>!O({kingPositions:[o.position,e],board:this.board})))}}!function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);s>3&&r&&Object.defineProperty(t,i,r)}([j],L.prototype,"getNextPositions",null);const Y={Pawn:S,Cannon:I,Rook:M,Knight:$,Bishop:X,Advisor:D,King:L},T=class extends C{constructor(i){super(),b(this,e,void 0),b(this,t,void 0),this.turn=n.Red,this.positions=this.getPositions(),g(this,e,[]),g(this,t,-1),this.pieces=[...this.initBlockPieces(),...this.initRedPieces()],this.emitter=null==i?void 0:i.emitter}get history(){return y(this,e)}set history(t){g(this,e,t)}get head(){return y(this,t)}set head(e){if(e<0)throw new Error(`非法 head: ${e}`);g(this,t,e)}onMove(e,t){const i={type:e.type,side:e.side,from:e.prevPosition,to:e.position};t&&(i.eat=t.type),this.head+1!==this.history.length&&(this.history=x(this.history,(e=>v(e,0,this.head+1))));const o=P(this.history);o&&o.side===i.side&&console.log("非法 move，应为对方回合",JSON.stringify(i)),this.history=x(this.history,(e=>{e.push(i)})),this.head=this.history.length-1}initBlockPieces(){return[S.createBlack({initPosition:{x:1,y:4},board:this}),S.createBlack({initPosition:{x:3,y:4},board:this}),S.createBlack({initPosition:{x:5,y:4},board:this}),S.createBlack({initPosition:{x:7,y:4},board:this}),S.createBlack({initPosition:{x:9,y:4},board:this}),I.createBlack({initPosition:{x:2,y:3},board:this}),I.createBlack({initPosition:{x:8,y:3},board:this}),M.createBlack({initPosition:{x:1,y:1},board:this}),M.createBlack({initPosition:{x:9,y:1},board:this}),$.createBlack({initPosition:{x:2,y:1},board:this}),$.createBlack({initPosition:{x:8,y:1},board:this}),X.createBlack({initPosition:{x:3,y:1},board:this}),X.createBlack({initPosition:{x:7,y:1},board:this}),D.createBlack({initPosition:{x:4,y:1},board:this}),D.createBlack({initPosition:{x:6,y:1},board:this}),L.createBlack({initPosition:{x:5,y:1},board:this})]}initRedPieces(){return[S.createRed({initPosition:{x:1,y:7},board:this}),S.createRed({initPosition:{x:3,y:7},board:this}),S.createRed({initPosition:{x:5,y:7},board:this}),S.createRed({initPosition:{x:7,y:7},board:this}),S.createRed({initPosition:{x:9,y:7},board:this}),I.createRed({initPosition:{x:2,y:8},board:this}),I.createRed({initPosition:{x:8,y:8},board:this}),M.createRed({initPosition:{x:1,y:10},board:this}),M.createRed({initPosition:{x:9,y:10},board:this}),$.createRed({initPosition:{x:2,y:10},board:this}),$.createRed({initPosition:{x:8,y:10},board:this}),X.createRed({initPosition:{x:3,y:10},board:this}),X.createRed({initPosition:{x:7,y:10},board:this}),D.createRed({initPosition:{x:4,y:10},board:this}),D.createRed({initPosition:{x:6,y:10},board:this}),L.createRed({initPosition:{x:5,y:10},board:this})]}redPieces(){return this.pieces.filter((e=>e.side===n.Red))}blackPieces(){return this.pieces.filter((e=>e.side===n.Black))}end(){return this.pieces.filter((e=>e.type===i.King)).length<2}reset(){var e;this.pieces=[...this.initBlockPieces(),...this.initRedPieces()],this.turn=n.Red,null==(e=this.emitter)||e.emit("reset",this)}canUndo(){return this.history.length>0&&this.head>=0}undo(){var e;if(this.canUndo()){this.switch();const t=this.history[this.head],i=this.findPiece(t.to);if(i.position=t.from,i.prevPosition=void 0,t.eat){const e=T.createPiece({board:this,type:t.eat,side:t.side===n.Black?n.Red:n.Black,initPosition:t.to});this.pieces.push(e)}this.head-=1,null==(e=this.emitter)||e.emit("undo",t)}else console.warn("cannot undo!")}canRedo(){return this.head+1!==this.history.length}redo(){var e;if(this.canRedo()){const t=this.history[this.head+1],i=this.findPiece(t.from);i.position=t.to,i.prevPosition=t.from,t.eat&&this.eatPiece(t.to),this.head+=1,null==(e=this.emitter)||e.emit("redo",t)}else console.warn("cannot redo!")}getPositions(){const e=[];let t=1;do{let i=1;do{e.push({x:i,y:t}),i+=1}while(i<=this.maxX);t+=1}while(t<=this.maxY);return e}findPiece(e){return this.pieces.find((t=>t.at(e)))}switch(){var e;this.turn=this.turn===n.Red?n.Black:n.Red,null==(e=this.emitter)||e.emit("switch",this.turn)}eatPiece(e){var t;const i=e instanceof K?e:this.findPiece(e);if(i&&i.side!==this.turn)return this.pieces=this.pieces.filter((e=>e!==i)),null==(t=this.emitter)||t.emit("eat",i),i}dump(){return{turn:this.turn,pieces:this.pieces.map((e=>e.dump())),history:R(this.history),head:this.head}}getNextMoves(e){return e.getNextPositions().map((t=>{const i={type:e.type,side:e.side,from:e.position,to:t},o=this.findPiece(t);return o&&(i.eat=o.type),i}))}move(e,t){var i;if(e.nextPositionsContain(t)){const o=this.eatPiece(t);if(e.prevPosition=e.position,e.position=t,this.onMove(e,o),null==(i=this.emitter)||i.emit("move",e,o),this.end())return;this.switch()}else console.log(`[warn] next position illegal: ${JSON.stringify(e.position)} => ${JSON.stringify(t)}`)}static createPiece(e){return new(0,Y[e.type])({board:e.board,side:e.side,initPosition:e.initPosition})}static load(e,t){const i=new T(t);return i.turn=e.turn,i.pieces=e.pieces.map((e=>T.createPiece({board:i,type:e.type,side:e.side,initPosition:e.position}))),i.history=e.history,i.head=e.head,i}clone(e){return T.load(this.dump(),e)}beautify(){let e="## 1,2,3,4,5,6,7,8,9\n";return this.positions.forEach(((t,i)=>{i%this.maxX==0&&(e+=`${k(""+(i/this.maxX+1),2,"0")} `);const o=this.findPiece(t);e+=o?`${o.getFENChar()} `:"_ ",i%this.maxX==8&&(e=e.trim(),e+="\n")})),`\n${e}`}};let J=T;e=new WeakMap,t=new WeakMap;class F{constructor(){this.emitter=w(),this.board=new J({emitter:this.emitter})}on(e,t){return this.emitter.on(e,t)}}function U(){const e=E.exports.useRef(),[,t]=E.exports.useState({}),i=()=>{t({})};return null==e.current&&(e.current=(e=>{const t=new F;return t.on("move",(()=>{e()})),t.on("reset",(()=>{e()})),t.on("undo",(()=>{e()})),t.on("redo",(()=>{e()})),t})(i)),e.current}function W(e){return e instanceof J?e.clone():J.load(e)}function q(e){return Math.floor(Math.random()*e)}function z(e){const t=[],i=W(e),o=()=>{const e=i.pieces.filter((e=>e.side===i.turn)).filter((e=>!t.includes(e)));if(!e.length)return null;const n=e[q(e.length)];return n.getNextPositions().length?n:(t.push(n),o())},n=o();if(!n)return null;const s=n.getNextPositions(),r=s[q(s.length)];return{from:n.position,to:r}}const H={[i.Pawn]:[[9,9,9,11,13,11,9,9,9],[19,24,34,42,44,42,34,24,19],[19,24,32,37,37,37,32,24,19],[19,23,27,29,30,29,27,23,19],[14,18,20,27,29,27,20,18,14],[7,0,13,0,16,0,13,0,7],[7,0,7,0,15,0,7,0,7],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],[i.Cannon]:[[100,100,96,91,90,91,96,100,100],[98,98,96,92,89,92,96,98,98],[97,97,96,91,92,91,96,97,97],[96,99,99,98,100,98,99,99,96],[96,96,96,96,100,96,96,96,96],[95,96,99,96,100,96,99,96,95],[96,96,96,96,96,96,96,96,96],[97,96,100,99,101,99,100,96,97],[96,97,98,98,98,98,98,97,96],[96,96,97,99,99,99,97,96,96]],[i.Rook]:[[206,208,207,213,214,213,207,208,206],[206,212,209,216,233,216,209,212,206],[206,208,207,214,216,214,207,208,206],[206,213,213,216,216,216,213,213,206],[208,211,211,214,215,214,211,211,208],[208,212,212,214,215,214,212,212,208],[204,209,204,212,214,212,204,209,204],[198,208,204,212,212,212,204,208,198],[200,208,206,212,200,212,206,208,200],[194,206,204,212,200,212,204,206,194]],[i.Knight]:[[90,90,90,96,90,96,90,90,90],[90,96,103,97,94,97,103,96,90],[92,98,99,103,99,103,99,98,92],[93,108,100,107,100,107,100,108,93],[90,100,99,103,104,103,99,100,90],[90,98,101,102,103,102,101,98,90],[92,94,98,95,98,95,98,94,92],[93,92,94,95,92,95,94,92,93],[85,90,92,93,78,93,92,90,85],[88,85,90,88,90,88,90,85,88]],[i.Bishop]:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,20,0,0,0,20,0,0],[0,0,0,0,0,0,0,0,0],[18,0,0,0,23,0,0,0,18],[0,0,0,0,0,0,0,0,0],[0,0,20,0,0,0,20,0,0]],[i.Advisor]:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,20,0,20,0,0,0],[0,0,0,0,23,0,0,0,0],[0,0,0,20,0,20,0,0,0]],[i.King]:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,0,0,0],[0,0,0,2,2,2,0,0,0],[0,0,0,11,15,11,0,0,0]]};function _(e){const t=e.side===n.Black?{x:e.position.x-1,y:e.position.y-1}:{x:e.position.x-1,y:e.maxY-e.position.y};return H[e.type][t.y][t.x]}function G(e){let t=0;return e.pieces.forEach((e=>{t+=e.side===n.Red?_(e):-_(e)})),t}function Q(e){const t=e.pieces.find((t=>t.type===i.King&&t.side===e.turn)),o=new A(t.position);return e.pieces.filter((t=>t.side!==e.turn)).some((e=>e.getNextPositions().some((e=>o.equal(e)))))}function V(e,t,i){console.log("call maxSearch, depth",t);const o={move:i,value:-1/0};if(0===t)return{move:i,value:G(e)};let n=[];return e.redPieces().forEach((t=>{n=n.concat(e.getNextMoves(t))})),n.forEach((n=>{const s=e.findPiece(n.from);if(e.move(s,n.to),Q(e))return void e.undo();const r=i||R({from:n.from,to:n.to}),a=Z(e,t-1,r);a.value>o.value&&(o.move=r,o.value=a.value),e.undo()})),o}function Z(e,t,i){console.log("call minSearch, depth",t);const o={move:i,value:1/0};if(0===t)return{move:i,value:G(e)};let n=[];return e.blackPieces().forEach((t=>{n=n.concat(e.getNextMoves(t))})),n.forEach((n=>{const s=e.findPiece(n.from);if(e.move(s,n.to),Q(e))return void e.undo();const r=i||R({from:n.from,to:n.to}),a=V(e,t-1,r);a.value<o.value&&(o.move=r,o.value=a.value),e.undo()})),o}function ee(e,t){const i=W(e),o=i.turn===n.Red?V(i,2):Z(i,2);return console.log("minimax result",o),(null==o?void 0:o.move)||null}const te=e=>{const{position:t,type:i="placeholder",selected:o,next:n,moved:s,onClick:r,children:a}=e,c="piece"===i;return B.createElement("div",{style:{position:"absolute",top:48*(t.y-1)-20,left:48*(t.x-1)-20,width:40,height:40,borderRadius:"50%",background:n?"#ffef99":c?"gold":"unset",boxShadow:s?"rgba(0, 0, 0, 0.24) 0px 3px 8px":"unset",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer"},className:c&&o?"piece-selected":"",onClick:()=>{null==r||r(t)}},a)},ie=e=>{const{board:t,actionRef:o}=e,[n,s]=B.useState(),[r,a]=B.useState(),c=t.maxX-t.minX+1,l=t.maxY-t.minY+1,d=e=>{const o=t.findPiece(e);if(n!==o){if(!(t.pieces.filter((e=>e.type===i.King)).length<2))return(null==n?void 0:n.nextPositionsContain(e))?(t.move(n,e),a(n),void s(void 0)):void(o&&o.side===t.turn&&s(o))}else s(void 0)};return B.useImperativeHandle(o,(()=>({click:d}))),B.createElement("div",{style:{display:"inline-block",padding:72}},B.createElement("div",null,new Array(l-1).fill(!0).map(((e,t)=>{const i={width:48*(c-1),height:47,borderBottom:"1px solid black"};return B.createElement("div",{key:`horizontal-line-${t+1}`,style:p(p({},i),0===t?{borderTop:"1px solid black"}:{})})}))),B.createElement("div",{style:{position:"relative",top:48*-(l-1)}},new Array(c).fill(!0).map(((e,t)=>0===t||t+1===c?B.createElement("div",{key:`vertical-line-${t+1}`,style:{position:"absolute",top:0,left:48*t,height:48*(l-1),borderRight:"1px solid black"}}):B.createElement(B.Fragment,{key:`vertical-line-${t+1}`},B.createElement("div",{style:{position:"absolute",top:0,left:48*t,height:48*(l/2-1),borderRight:"1px solid black"}}),B.createElement("div",{style:{position:"absolute",top:240,left:48*t,height:48*(l/2-1),borderRight:"1px solid black"}})))),t.positions.map((e=>{const i=t.findPiece(e);return B.createElement(te,{key:`${JSON.stringify(e)}`,position:e,type:i?"piece":"placeholder",next:n&&(null==n?void 0:n.nextPositionsContain(e)),moved:r&&i===r,selected:i===n,onClick:d},i&&B.createElement("span",{style:{color:i.side.toLowerCase()}},i.getName()))}))))};var oe,ne;(ne=oe||(oe={}))[ne.Player=0]="Player",ne[ne.RandomAI=1]="RandomAI",ne[ne.MinimaxAI=2]="MinimaxAI",ne[ne.AlphaBetaAI=3]="AlphaBetaAI";const se=[{value:0,label:"玩家"},{value:1,label:"AI (random)"},{value:2,label:"AI (minimax)"},{value:3,label:"AI (alpha–beta)",disabled:!0}];function re(e,t){const{index:i=0,onEnd:o}=t||{};console.log("call action",i),e[i](),console.log("call action end",i),i+1<e.length&&setTimeout((()=>{re(e,{index:i+1,onEnd:o})}),800),i+1===e.length&&(null==o||o())}var ae=()=>{const e=U(),t=E.exports.useRef(),[o,s]=E.exports.useState(!1),[r,a]=E.exports.useState(0),[c,l]=E.exports.useState(2),d=i=>{var o;s(!0);const r=("random"===i?z:ee)(e.board);r?(console.log(`handleAI move: ${null==(o=e.board.findPiece(r.from))?void 0:o.getName()} ${JSON.stringify(r.from)} => ${JSON.stringify(r.to)}`),re([()=>{var e;return null==(e=t.current)?void 0:e.click(r.from)},()=>{var e;return null==(e=t.current)?void 0:e.click(r.to)}],{onEnd:()=>s(!1)})):(s(!1),alert((e.board.turn===n.Red?"红方":"黑方")+" 认输！"))},h=e=>{setTimeout((()=>{if(e===n.Red)switch(r){case 1:return void d("random");case 2:return void d("minimax");default:return}else switch(c){case 1:return void d("random");case 2:return void d("minimax");default:return}}))};E.exports.useEffect((()=>{const t=e.on("switch",h);return()=>t()}),[r,c]),E.exports.useEffect((()=>{e.board.end()||h(e.board.turn)}),[r,c]);return B.createElement("div",{style:{textAlign:"center"}},B.createElement("div",{style:{marginTop:24}},B.createElement("span",null,(()=>{const t=e.board.pieces.some((e=>e.type===i.King&&e.side===n.Black))?e.board.pieces.some((e=>e.type===i.King&&e.side===n.Red))?null:n.Black:n.Red;return t?(t===n.Red?"红方":"黑方")+"获胜!":(e.board.turn===n.Red?"红方":"黑方")+"着手"})())),B.createElement("div",null,B.createElement("span",null,o?"running...":"idle...")),B.createElement(ie,{board:e.board,actionRef:t}),B.createElement("div",null,B.createElement("label",null,"红方")," ",B.createElement("select",{value:r,onChange:e=>a(Number(e.target.value))},se.map((e=>B.createElement("option",{key:e.value,value:e.value,disabled:e.disabled},e.label)))),"  ",B.createElement("label",null,"黑方")," ",B.createElement("select",{value:c,onChange:e=>l(Number(e.target.value))},se.map((e=>B.createElement("option",{key:e.value,value:e.value,disabled:e.disabled},e.label))))),B.createElement("hr",null),B.createElement("div",null,B.createElement("label",null,"Next move by AI:")," ",B.createElement("button",{disabled:o,onClick:()=>d("random")},"random")," ",B.createElement("button",{disabled:o,onClick:()=>d("minimax")},"minimax")," ",B.createElement("button",{disabled:!0},"alpha–beta (coming soon)")),B.createElement("hr",null),B.createElement("div",null,B.createElement("button",{onClick:()=>e.board.reset(),disabled:o},"重新开始")," ",B.createElement("button",{disabled:!e.board.canUndo()||o,onClick:()=>e.board.undo()},"Undo")," ",B.createElement("button",{disabled:!e.board.canRedo()||o,onClick:()=>e.board.redo()},"Redo")))};N.render(B.createElement(B.StrictMode,null,B.createElement(ae,null)),document.getElementById("root"));
